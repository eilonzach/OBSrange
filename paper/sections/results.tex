
\subsection{Demonstration on synthetic data} \label{Demonstration on synthetic data}
We validated our algorithm by checking that it correctly recovers the (known) location of synthetic test stations. Synthetic two-way travel times were computed by interpolating the ship's position within a fixed survey pattern at one-minute intervals, sending straight-line rays to the instrument and back, and adding the turn-around time. This travel time includes the change in ship's position between sending and receiving; since the position of the ship at the time it receives the acoustic pulse is itself dependent on the travel time, we iterated on this value until the time and position converged to give an error of \mbox{$<10^{-6}$ s}. Only the location and absolute time at the time the ship receives the acoustic pulse was recorded for the inversion, mimicking the data obtained from the EdgeTech deck box. We then added Gaussian random noise to the resultant travel times using a standard deviation of 4 ms, to account for measurement noise, errors in ship GPS location, and local changes in water velocity. Lastly, we randomly dropped out $\sim$20\% of the travel time data points, simulating the occasional null return from the acoustic survey. This testing procedure was designed to mimic the idiosyncrasies of real acoustic surveys as closely as possible. 

Figure \ref{fig:one_sta_synth} shows the result of an inversion at a single station. For this inversion, we included a correction for a Doppler shift introduced by the ship's motion, estimating ship velocity from the timing and location of survey points. The inversion was successful in locating the OBS station: the estimated location is 3.02 m from the the true location (Figure \ref{fig:one_sta_synth}). This misfit is extremely small in the context of $\sim$320 m of drift, a survey radius of $\sim$3700 m, and a water depth of $\sim$5300 m. Moreover, the true location falls well within the uncertainty bounds estimated from the F-test and the bootstrap analysis. 

In order to obtain statistics on the general quality of the synthetic recovery, we performed this test for 10,000 synthetic OBS stations, as follows: For each iteration, a synthetic station location was determined relative to a fixed drop point by drawing x- and y- drifts from zero-centered Gaussian distributions with standard deviations of 100 m (only in rare cases are stations thought to drift further than $\sim$200 m). The depth perturbation, turn-around time, and water velocity perturbation were similarly randomly selected, with mean values of 5000 m, 13 ms, and 1500 m/s and standard deviations of 50 m, 3 ms, and 10 m/s, respectively.  For tests of the basic location algorithm, we held the survey geometry constant, using the \textit{PACMAN} configuration with a radius of 1 Nm (Section \ref{sec:surv_geom_tests}). 

%Unlike for the real data, we did not bootstrap the individual synthetic locations and take a median, but inverted each station once using Newton's method (Equation \ref{eq:inverse}).   
The results of these tests show that on average our inversion is highly successful in correctly locating the OBS stations. The mean location errors in the x-, y-, and z- directions were 0.038 m, 0.152 m, and -0.599 m respectively, demonstrating there was no systematic bias in the locations. The mean errors in water velocity and turn-around time were indistinguishable from zero, showing that estimation of these parameters was also not biased. The mean absolute horizontal location error was 2.31 m, with a standard deviation of 1.22 m. 95\% of the absolute horizontal station location errors were less than 4.58 m. There was no relationship observed between station drift (\textit{i.e.}, the distance between the synthetic OBS station and the drop point) and the location error, indicating that as long as stations settle within the survey bounds they will be well located. A corollary to this observation is that location estimates should not be biased by incorrectly recorded drop locations. 

We observed a strong trade-off between water velocity and depth, which was responsible for the somewhat larger standard error in station depth estimates, which was \mbox{9.6 m}. This uncertainty is likely of negligible concern for most OBS practitioners, but if precise depths are important then a survey geometry that includes more tracks towards and away from the station would be preferable (in addition to verification using acoustic echo-sounders that implement precise water-velocity profiles from XBT data).

\subsection{Application to PacificArray deployment}
We applied the location algorithm to acoustic surveys carried out during the \textit{Young Pacific ORCA (OBS Research into Convecting Asthenosphere)} deployment in the central Pacific ocean during April and May of 2018. The OBS array comprised 30 SIO broadband instruments deployed from the R/V Kilo Moana in water depths of $\sim$4400-4800 m. Acoustic  surveys were carried out using an EdgeTech 8011M Acoustic Transceiver command and ranging unit, attached to a hull-mounted 12 kHz transducer. The relatively calm seas allowed for ideal survey geometry at almost all sites, with a ship speed of \mbox{$\le$8 knots} at a maximum radius of \mbox{$\sim$1.3 Nm}. 

An example station inversion, as well as the graphical outputs of the location software, is shown in Figures \ref{fig:one_sta_real_survey}-\ref{fig:one_sta_real_ftests}. Ship velocity is estimated from the survey data by differencing survey points. In theory, this could be used to correct Doppler shifts (Figure \ref{fig:one_sta_real_survey}c) in travel time (as in the synthetic tests), but we found that this correction did not substantially improve data fit for real stations and so did not apply it to this data set, although it is included as an option in the location codes. The small RMS data misfit of $\sim$1.6 ms attests to the quality of the survey measurements and the appropriateness of our relatively simple location algorithm. The southwestwards drift of \mbox{$\sim340$ m} demonstrates that ocean currents can substantially displace the final OBS location from their surface drop point. 

The 30 stations in this array drifted an average distance of 170 m. The mean data RMS misfit was 1.96 ms and the estimated 95\% percentile location error based on the bootstrap analysis was 1.13 m. The water depth estimated by the inversion was systematically shallower than that measured using the shipboard multibeam instrument, differing by an average value of 18.6 m. Assuming the multibeam depths, which are computed using a water sound speed profile that is validated daily by XBT measurements, are correct, this discrepancy indicates that the inversion systematically overestimates sound speed slightly. 

Without accurate seafloor corroboration from an ROV, it is not possible to directly verify the locations of stations within the Pacific ORCA array. However, we  obtain indirect support for the success of the location algorithm by considering the drift of all stations within this array (Figure \ref{fig:meso_eddy}). Taken together, the direction and magnitude of drift depicts a pattern of clockwise rotation with a minimum diameter of $\sim$500 km. This system appears to correlate with a meso-scale ocean gyre, with a direction, location, and approximate size that is consonant with large-scale patterns of geostrophic flow modeled in this location within the time frame of our deployment. We speculate that a large fraction of the OBSs' lateral drift is achieved in the upper \textit{\textbf{X}} m of the ocean, where horizontal flow amplitudes are highest [\#REF]. The fact that we are able to discern this pattern from our estimated locations is a testament to the accuracy of the OBSrange algorithm. This observation also raises the intriguing possibility of using OBS instruments as ad hoc depth-integrated flow meters for the oceans. 

\subsection{Comparison to previous tools}

We compared our location algorithm with a tool developed by engineers at Scripps Institution of Oceanography (SIO) that has previously been used to locate OBS on the seafloor. This unpublished tool, hereby referred to as \textit{SIOgs}, performs a grid search in $x$--$y$ holding $z$ fixed at the reported drop-point depth and assumes a water velocity of 1500 m/s and turn-around time of 13 ms. The grid search begins with grid cells of 100$\times$100~m and iteratively reduces their size to 0.1$\times$0.1~m. In contrast to our algorithm, \textit{SIOgs} does not account for: 1) the $\delta T$ (Doppler) correction due to the changing ship position between sending and receiving, 2) the ellipsoidal shape of the earth when converting between latitude--longitude and $x$--$y$, 3) variations in $z$, $\tau$, and $V_p$, and 4) automated identification and removal of low-quality travel-time data. Furthermore, \textit{SIOgs} provides no information about uncertainty or resolution of model parameters.  

To quantitatively compare our algorithm with \textit{SIOgs}, as well as the importance of the 4 additional features that our algorithm includes, we performed 9 separate inversions of a synthetic dataset for a \textit{PACMAN} survey geometry with 1 Nm radius (Figure~\ref{fig:compare_tool}). For the synthetic experiment, the instrument drifted 447~m from the drop point, settling to 5050~m depth with 4~ms of Gaussian noise added to the data. We inverted using the complete \textit{OBSrange} algorithm as well as several variants where parameters were damped or removed to assess their importance; details of the inversions are given in table~\ref{table:compare_tool}. Our algorithm estimated the horizontal position of the instrument to within $\sim$1.5~m of the true location with a data RMS misfit of 4.2~ms, while \textit{SIOgs} located it $\sim$42~m from the true position with an RMS of 22.8~ms, far beyond the 95\% F-test contour (Figure~\ref{fig:compare_tool}a). Our algorithm recovered the true depth, turn-around time, and water velocity to within 5~m, 0.2~ms, and 1~m/s, respectively.

The \textit{SIOgs} tool was very susceptible to anomalous travel-time data. Inversion \textit{SIOgs no QC} included a single anomalous travel-time measurement 2000~ms from its true value, causing the station to be mislocated by $\sim$130~m with a travel-time residual RMS of $\sim$193~ms. Although such outliers can be manually removed, they may easily be overlooked. Therefore, our method includes a quality control step based on travel-time residuals of the starting location that removes anomalous residuals with magnitudes $>$500 ms.

Inversions that did not include $z$ and/or $V_p$ as parameters resulted in the largest instrument location errors. With depth held constant at 5000~m (\textit{Fix-Z}), the instrument was mislocated by $\sim$8.5~m and water velocity underestimated by $\sim$14~m/s. Similarly, with $V_p$ held constant (\textit{Fix-$V_p$}), the instrument was located $\sim$12~m from its true position, and the estimated depth was $\sim$70~m too shallow. In the case where both depth and water velocity were held constant (\textit{XY-only}), we observed location misfits of $\sim$40~m, similar to those of the \textit{SIOgs} tool. The strong trade-off between depth and water velocity means that one cannot be confidently recovered without also solving for the other, and failing to solve for one (or both) results in larger location errors.

%In addition to showing the full potential of \textit{OBSrange}, we demonstrate the importance of including the "Doppler" correction ($\delta T$ in equation (5)), and of accounting for Earth's ellipsoidal shape when converting latitude and longitude to $x$--$y$.

In addition to showing the full potential of \textit{OBSrange}, we demonstrate the importance of accounting for Earth's ellipsoidal shape when converting latitude and longitude to $x$--$y$. The travel-time residuals of \textit{SIOgs} (Figure~\ref{fig:compare_tool}b) display both a static shift from 0~ms as well as an azimuthal dependence. The shift of approximately -20~ms is a combination of the incorrectly assumed station depth, water velocity, and turn-around time and accounts for most of the data misfit. The azimuthal variation observed in the travel-time residuals of \textit{SIOgs} is due to both the incorrect horizontal location of the instrument as well as the failure to account for Earth's ellipsoidal shape when converting from geographic coordinates to $x$--$y$. Failing to account for the ellipsoid produces a 2-theta azimuthal pattern in the residuals that becomes increasingly strong as survey radius increases and at lower latitudes. For this synthetic test with a survey radius of 1 Nm ($\sim$1852 m) at 7.5$^{\circ}$S, the ellipsoid produced a $\sim$10~m apparent shift to the northern and southern ship positions. The 2-theta ellipsoid anomaly had a peak-to-peak amplitude of $\sim$5.5~ms. Correcting for this anomaly slightly improved our ability to accurately recover station depth and water velocity; however, it did not significantly effect the the horizontal location estimate.

The ``Doppler'' corrections ($\delta T$ in equation~(\ref{eq:forward})) applied to the two-way travel times provided only a very small improvement to the estimated horizontal instrument locations ($\sim$3.5~m improvement in mean horizontal location and $\sim$2.5~m reduction in $r_{xy}$ RMS misfit). The effectiveness of these corrections depend strongly on the accuracy of the shipboard GPS as well as its position relative to the acoustic receiver. They also depend on the ability to accurately reconstruct the ship's radial velocity, which can be difficult to achieve if large swaths of the survey return poor-quality soundings. Turn-around time did not have a strong effect on the ability to recover the other 4 parameters. When held constant at 13~ms (\textit{Fix-$\tau$}), the resulting model parameters were indistinguishable from the full \textit{OBSrange} inversion. Indeed, turn-around time is the parameter that requires the most damping in order to stabilize the inversion.


\subsection{Exploration of survey pattern geometries} \label{sec:surv_geom_tests}

In order to evaluate which survey patterns are optimal for accurately locating instruments on the seafloor, we conducted 17 synthetic surveys of varying geometry and size. For these tests, we attempted to mimic real-world experimental uncertainty as closely as possible. Each parameter ($x$, $y$, $z$, $\tau$, $V_p$) was treated as a Gaussian random variable with a predetermined mean and standard deviation (see Section~\ref{Demonstration on synthetic data} for means and standard deviations). For each survey configuration, we applied the \textit{OBSrange} algorithm to 10,000 realizations drawn from these distributions in order to fully explore the limits of each survey type. Synthetic data were calculated in the same way as previous sections with $\sim$20\% of the data points randomly removed. To further simulate realistic data loss due to ``shadowing'' effects associated with topography obstructing the signal propagation path, we removed three sectors of data with random central azimuth and half-width standard deviation of 20$^{\circ}$ for each realization (excluding \textit{Line} surveys). Survey points $<$100~m from the drop point are retained.

The resulting RMS misfits for each model parameter and survey type are shown in Figure~\ref{fig:survey_geom_explore}. The most well-resolved parameter for all survey types is the horizontal location of the instrument on the seafloor, $r_{xy}$. With the exception of \textit{Line} surveys, all survey types resolve horizontal location to within the true RMS error ($\sim$140 m). The \textit{Line} surveys fail to resolve the instrument location along the direction orthogonal to the ship track (RMS $\sim$700~m) but succeeds in resolving its location parallel to the line (RMS $\sim$4~m). This is also shown in Figure~\ref{fig:resolution_correlation}, where model parameter $y$ is poorly resolved for a ship track parallel to the x-direction. The \textit{PACMAN} survey with radius $\geq$1~Nm performs best with horizontal RMS misfits of less than 4~m. Misfit increases as survey radius decreases, but the \textit{PACMAN} survey still recovers the horizontal location to within 10~m even for a survey with radius of only 0.5~Nm.

Depth and water velocity are best resolved by the \textit{PACMAN} geometry with radius $\geq$1~Nm, recovering $z$ and $V_{P}$ to within 10~m and 3~m/s, respectively. Due to strong trade-offs, both depth and water velocity are poorly resolved by the \textit{Circle} as well as small ($<$0.5~Nm) \textit{PACMAN} surveys. This trade-off can be seen in the resolution and correlation matrices for the \textit{Circle} in Figure~\ref{fig:resolution_correlation}. Therefore, the radial portions of the \textit{PACMAN} survey are key for successfully resolving the $z$-$V_P$ trade-off. The \textit{Line} survey poorly estimates depth (RMS $\sim$200~m) but resolves water velocity to within $\sim$5~m/s.

All survey types recover the turn-around time relatively poorly, as indicated by an RMS of $\sim$3~ms for all surveys, equal to the standard deviation of the $\tau$ distribution. The turn-around time is strongly damped toward the starting value in the inversions in order to produce stable results. Figure~\ref{fig:resolution_correlation} shows that $\tau$ trades off nearly equally between $z$ and $V_{P}$ for the \textit{Circle} and \textit{PACMAN} patterns, suggesting that these three parameters cannot be independently determined without additional information. Since turn-around time is specified by the transponder manufacturer and not expected to vary appreciably from its listed value, we simply damp $\tau$ heavily toward that value.

The 1~Nm radius \textit{Cross}, \textit{Diamond}, and \textit{Triangle} survey geometries recover $x$, $y$, $z$, and $V_{p}$ similarly well and are comparable in performance to \textit{PACMAN} of radius 0.5--0.75~Nm. Of these alternative survey configurations, the \textit{Diamond} performs best. However, for the same radius of 1~Nm, the \textit{PACMAN} survey yields the lowest RMS misfits, outperforming all other geometries tested. Therefore, the \textit{PACMAN} survey pattern with radius $\geq$1~Nm is the optimal geometry for accurately locating instruments on the seafloor.

% - Mean signed error (MSE): Tells us about bias in the inversion; Zero means there's no bias. They are ~0 for for all surveys except PACMAN0.1, PACMAN0.5, Circle, and Line (Actually circle 0.5 Nm isn't too bad for some reason). Largest tradeoffs are for depth (~100 m) and water velocity (~25 m/s) for circle arrays with opposite signs indicating tradeoffs (see Figure~7). Also significant biases in the mean for line surveys in y (100-200 m) and z (~60 m), but they don't appear to trade off.

% - RMS increases with the increasing variance of frequency distribution of error magnitudes. 
% - MAE increases with the increasing variance of error.
% MAE = RMS for uniformly distributed errors (all errors are the same), otherwise RMS > MAE
% RMS/MAE > 1 signifies outliers. The larger the ratio, the more outliers (think about using this ratio?)

% For resolving horizontal location, all surveys do well except for line tests. Line geometries are completely insensitive to the direction orthogonal to the line but recover the true location quite well in the direction parallel to the strike of the line (x-direction in these tests). PACMAN with radius >= 1 Nm does the best job at recovering the true horizontal position with lowest RMS [#Value].

% Depth is best resolved by PACMAN > 1 Nm. However it is poorly resolved by PACMAN < 0.25 Nm and by all circle and line tests. The radial line in the PACMAN survey helps reduce the Vp and Z trade-off. On the other hand, Z and Vp trade of perfectly for the Circle geometry (Figure 7).

% Velocity is recovered best by PACMAN > 1 Nm. It is recovered poorly by PACMAN < 0.5 Nm and by the Circle arrays, both of which exhibit a velocity-depth tradeoff.

% The Cross, Diamond, and Triangle tests do approximately equally well at recovering x, y, z, and Vp. Diamond correlation matrix looks very similar to that of PACMAN. The triangle edge survey displays a strong correlation between X, Z, and Vp. The triangle center 

%All survey types do poorly at recovering the turn-around time, as indicated by an RMS of $\sim$3~ms, equal to the standard deviation of the $\tau$ distribution.

% Line implications for active-source surveys: Line cannot resolve station location along the direction orthogonal to the line. Alternatives are the Cross and Triangle-center geometries which provides a model correlation structure similar to the line but have spread(R)~0.