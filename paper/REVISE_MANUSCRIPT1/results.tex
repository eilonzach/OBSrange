We summarize the results of synthetic testing and application to a real data set in order to demonstrate the robust features of \textit{OBSrange}. All synthetic tests shown in this section were carried out at 5000~m depth unless noted otherwise. This depth is similar to the average depth of the Young Pacific ORCA Experiment, where the tool is applied in section~\ref{sec:PacificArray_deployment}, allowing for easier comparison. Furthermore, the magnitude of uncertainties generally decrease for shallow water (see Figures~S7--S10, available in the electronic supplement to this article), and therefore, uncertainties presented here represent upper bounds for the algorithm.

\subsection{Demonstration on synthetic data} \label{Demonstration on synthetic data}
We validated our algorithm by checking that it correctly recovers the (known) location of synthetic test stations. Synthetic two-way travel times were computed by interpolating the ship's position (traveling at an average velocity of 8~kn) within a fixed survey pattern at one-minute intervals, sending straight-line rays to the instrument and back, and adding the turn-around time. This travel time includes the change in ship's position between sending and receiving; since the position of the ship at the time it receives the acoustic pulse is itself dependent on the travel time, in constructing the synthetic dataset we iterated on this value until the time and position converged to give an error of \mbox{$<10^{-6}$ s}. Only the two-way travel time, ship location, and absolute time at the moment the ship receives the acoustic pulse were recorded for the inversion, mimicking data obtained during real surveys using equipment such as an EdgeTech deck box. We then added Gaussian random noise to the resultant travel times using a standard deviation of 4 ms, to account for measurement noise, errors in ship GPS location, and local changes in water velocity. Lastly, we randomly dropped out $\sim$20\% of the travel time data points, simulating the occasional null return from the acoustic survey. This testing procedure was designed to mimic the idiosyncrasies of real acoustic surveys as closely as possible. 

Figure \ref{fig:one_sta_synth} shows the result of an inversion at a single station at 5000~m depth using a 1~Nm radius ``\textit{PACMAN}'' survey geometry. For this inversion, we included the correction for a Doppler shift introduced by the ship's motion, estimating ship velocity from the timing and location of survey points. The inversion was successful in locating the OBS station: the estimated location is 3.0 m from the the true location (Figure \ref{fig:one_sta_synth}). This misfit is extremely small in the context of $\sim$320~m of drift, a survey radius of $\sim$1800~m (1~Nm), and a water depth of $\sim$5300~m. Moreover, the true location falls well within the uncertainty bounds estimated from the F-test and the bootstrap analysis. 

In order to obtain statistics on the general quality of the synthetic recovery, we performed this test for 10,000 synthetic OBS stations, as follows: For each iteration, a synthetic station location was determined relative to a fixed drop point by drawing x- and y-drifts from zero-centered Gaussian distributions with standard deviations of 100 m (only in rare cases are stations thought to drift further than $\sim$200 m). The depth and average water velocity were similarly randomly selected, with mean values of 5000 m and 1500 m/s and standard deviations of 50 m and 10 m/s, respectively. The turn-around time is set to 14~ms and is perfectly accounted for. For tests of the basic location algorithm, we held the survey geometry constant, using the \textit{PACMAN} configuration with a radius of 1~Nm (see Section~\ref{sec:surv_geom_tests}). 
  
The results of these tests show that on average our inversion is highly successful in correctly locating the OBS stations. The mean location errors in the x-, y-, and z-directions were 0.038 m, 0.152 m, and -0.599 m respectively, demonstrating there was no systematic bias in the locations. The mean error in water velocity was indistinguishable from zero, showing that its estimation was also not biased. The mean absolute horizontal location error was 2.3 m, with a standard deviation of 1.2 m. 95\% of the absolute horizontal station location errors were less than 4.6 m. There was no relationship observed between station drift (i.e., the distance between the synthetic OBS station and the drop point) and the location error, indicating that as long as stations settle within the survey bounds they will be well located. A corollary to this observation is that location estimates should not be biased by incorrectly recorded drop locations. 

We observed a strong trade-off between water velocity and depth, which was responsible for the somewhat larger standard error in station depth estimates, which was \mbox{9.6~m}. This uncertainty is likely of negligible concern for most OBS practitioners, but if precise depths are important then a survey geometry that includes more tracks towards and away from the station would be preferable (in addition to verification using acoustic echo-sounders that implement precise water-velocity profiles from XBT data as well as an accurate GPS-transponder offset correction).

\subsection{Comparison to previous tools}

We compared our location algorithm with a tool developed by engineers at Scripps Institution of Oceanography (SIO) that is commonly used to locate OBS on the seafloor. This unpublished tool, hereafter referred to as \textit{SIOgs}, performs a grid search in $x$--$y$ holding $z$ fixed at the reported drop-point depth and assuming a water velocity of 1500 m/s and turn-around time of 14 ms. The grid search begins with grid cells of 100$\times$100~m and iteratively reduces their size to 0.1$\times$0.1~m. In contrast to our algorithm, \textit{SIOgs} does not account for: 1) the Doppler correction ($\delta T_{\text{dopp}}$) due to the changing ship position between sending and receiving, 2) the ellipsoidal shape of the Earth when converting between latitude-longitude and $x$--$y$, 3) a known GPS-transponder offset, 4) variations in $z$ and $V_p$, and 5) automated identification and removal of low-quality travel-time data. Furthermore, \textit{SIOgs} provides no information about uncertainty or resolution of model parameters.  

To quantitatively compare our algorithm with \textit{SIOgs}, as well as the importance of the 5 additional features that our algorithm includes, we performed 9 separate inversions of a synthetic dataset for a \textit{PACMAN} survey geometry with 1 Nm radius and 4~ms of Gaussian noise added to the travel-time data (Figure~\ref{fig:compare_tool}). For the synthetic experiment, the instrument drifted 447~m from the drop point, settling to 5050~m depth with a water velocity of 1520~m/s and turn-around time of 14~ms. Relative to the GPS, the transponder was located 10~m closer to the ship's bow and 10~m further starboard (a maximum offset of $\sim$14~m). We inverted using the complete \textit{OBSrange} algorithm (inversion 1 in Figure~\ref{fig:compare_tool}) as well as several variants where parameters were damped or removed to assess their importance; details of the inversions including the starting models are given in table~\ref{table:compare_tool}. Our algorithm estimated the horizontal position of the instrument to within $\sim$1.5~m of the true location with a mean data RMS misfit of 3.7~ms, while \textit{SIOgs} (inversion 8) located it $\sim$42~m from the true position with an RMS of 19.7~ms, far beyond the 95\% F-test contour (Figure~\ref{fig:compare_tool}a). Our algorithm recovered the true depth and water velocity to within 3~m and 1~m/s on average, respectively.

The \textit{SIOgs} tool was very susceptible to anomalous travel-time data, which are a common occurrence in real survey data and are thought to result from out-of-plane acoustic reflections or multiples of earlier pulses. Inversion \textit{SIOgs no QC} (9) included a single anomalous travel-time measurement 4000~ms from its true value, causing the station to be mislocated by $\sim$320~m with a travel-time residual RMS of $\sim$383~ms. We found that if several such erroneous travel-time data are included in the SIO inversion, a horizontal location misfit on the order of $\sim$1000~m can result. Although such outliers can be manually discarded, they could potentially be overlooked. As mentioned, our method includes a quality control step based on travel-time residuals of the starting location that removes such anomalous residuals with magnitudes $>$500 ms (default value in the code).

\textit{OBSrange} inversions that did not solve for $z$ and/or $V_p$ resulted in the largest instrument location errors. With depth held constant at 5000~m (inversion 6), the instrument was mislocated by $\sim$7.5~m and water velocity underestimated by $\sim$14~m/s. Similarly, with $V_p$ held constant (inversion 5), the instrument was located $\sim$11~m from its true position, and the estimated depth was $\sim$72~m too shallow. In the case where both depth and water velocity were held constant (inversion 7), we observed a location misfit of $\sim$40~m, similar to that of the \textit{SIOgs} tool (8). The strong trade-off between depth and water velocity means that one cannot be confidently recovered without also solving for the other, and failing to solve for one (or both) results in larger location errors.

In addition to showing the full potential of \textit{OBSrange}, we demonstrate the importance of accounting for Earth's ellipsoidal shape when converting latitude and longitude to $x$--$y$ (inversion 3). The travel-time residuals of \textit{SIOgs} (Figure~\ref{fig:compare_tool}b) display both a static shift from 0~ms as well as an azimuthal dependence. The shift of approximately -20~ms is a combination of the incorrectly assumed station depth, and water velocity and accounts for most of the data misfit. The azimuthal variation observed in the travel-time residuals of \textit{SIOgs} is due to both the incorrect horizontal location of the instrument as well as the failure to account for Earth's ellipsoidal shape when converting from geographic coordinates to $x$--$y$. Failing to account for the ellipsoid produces a 2-theta azimuthal pattern in the residuals that becomes increasingly strong as survey radius increases and at lower latitudes. For this synthetic test with a survey radius of 1 Nm ($\sim$1852 m) at $\sim$6$^{\circ}$S, the ellipsoid produced a maximum apparent horizontal shift to the northern and southern ship positions of $\sim$10~m (see Figures~S3--S4, available in the electronic supplement to this article). The resulting 2-theta ellipsoid travel-time anomaly had an RMS of $\sim$2.2~ms with a mean of -1.3~ms, indicating that failing to account for the ellipsoid leads to small biases that map directly into $z$ and $Vp$. Correcting for this anomaly slightly improved the ability to accurately recover station depth and water velocity; however, it did not significantly effect the the horizontal location estimate, owing to the roughly symmetric survey pattern (i.e., the perturbation to travel times are nearly symmetric with respect to ship azimuth in Figures~S3--S4). For non-symmetric surveys, including those with a strong back-azimuthal variation in good acoustic returns, horizontal location biases resulting from improper ellipticity corrections may be more significant.

Failing to account for the relative offset in shipboard GPS and transponder (with transponder located $\sim$14~m from the GPS toward the front-right of the ship) leads to biased $z$ and $V_p$ estimates (inversion 4). Instrument depth and water velocity are underestimated by $\sim$28~m and $\sim$8~m/s, respectively. The difference in transponder-to-instrument and GPS-to-instrument two-way travel times is nearly constant with ship azimuth for the \textit{PACMAN} configuration (see Figure~S5, available in the electronic supplement to this article) with a mean of $\sim$3.4~ms. This constant travel time offset is primarily mapped into $z$. Because the transponder is almost always further away than the GPS from the instrument, this results in a $z$ estimate that is too shallow. Similarly, if the transponder had been located at the back-left of the ship, then it would have been closer than the GPS to the instrument and $z$ would be estimated too deep. This suggests that in principle, the GPS-transponder offset could be solved for; however, in practice there is significant trade off between GPS-transponder offset, depth, and water velocity such that it would be difficult to resolve unless $z$ and $V_p$ are known. The horizontal uncertainties are still small ($\sim$3~m), even without this correction applied.

The ``Doppler'' corrections ($\delta T_{\text{dopp}}$ in equation~(\ref{eq:forward})) applied to the two-way travel times provided only a very small improvement to the estimated horizontal instrument locations ($\sim$2.7~m improvement in mean horizontal location and $\sim$2.0~m reduction in $r_{xy}$ RMS misfit; see inversion 2). Because this correction term is calculated from the ships radial velocity with respect to the instrument, it is small (magnitudes $<$1.6~ms) for the circular portions of the survey and relatively large ($\sim$6~ms) for the radial segments. Only a small portion of the \textit{PACMAN} survey occurs along the radial direction (Figure~\ref{fig:one_sta_synth}a) and therefore, these corrections tend to have a small effect on model recovery. In practice, the effectiveness of these corrections depend strongly on the precision of the shipboard GPS as well as an accurate reconstruction of ship velocity, which can be difficult to achieve if large swaths of the survey fail to return soundings.


\subsection{Exploration of survey pattern geometries} \label{sec:surv_geom_tests}

In order to evaluate which survey patterns are optimal for accurately locating instruments on the seafloor, we conducted 19 synthetic surveys of varying geometry and size. For these tests, we attempted to mimic real-world experimental uncertainty as closely as possible. Each parameter ($x$, $y$, $z$, $V_p$) was treated as a Gaussian random variable with a predetermined mean and standard deviation (see Section~\ref{Demonstration on synthetic data} for means and standard deviations). For each survey configuration, we applied the full \textit{OBSrange} algorithm (including corrections for Doppler and GPS-transponder offset) to 10,000 realizations drawn from these distributions in order to fully explore the limits of each survey type. The GPS-transponder offset is the same as in the previous section ($sim$14~m). Synthetic data were calculated in the same way as in previous sections with $\sim$20\% of the data points randomly removed. To further simulate realistic data loss due to ``shadowing'' effects associated with topography obstructing the acoustic propagation path, we removed three sectors of data with random central azimuth and half-width standard deviation of 20$^{\circ}$ for each realization (excluding \textit{Line} surveys). All survey points $<$100~m from the drop point were retained. The precise uncertainties and optimal survey sizes as determined in this section are specific to an average water depth of 5000~m and scale down at shallower depths. Additional tests at 500~m and 2000~m average water depth are shown in Figures~S7--S10 in the electronic supplement and demonstrate that uncertainties generally decrease with decreasing water depth, and thus uncertainties stated in this section represent upper bounds for the algorithm.

The resulting RMS misfits for each model parameter and survey type are shown in Figure~\ref{fig:survey_geom_explore}a--c. The most well-resolved parameter for all survey types is the horizontal location of the instrument on the seafloor, $r_{xy}$. With the exception of \textit{Line} and 1.5~Nm \textit{Circle} surveys, all survey types resolve horizontal location to within 50~m. The \textit{Line} surveys fail to resolve the instrument location along the direction orthogonal to the ship track (RMS $\sim$700~m) but succeed in resolving its location parallel to the line (RMS $\sim$4~m). This is also shown in plots of model resolution (Figure~\ref{fig:resolution_correlation}), where model parameter $y$ is unresolved for a ship track parallel to the x-direction. The \textit{PACMAN} survey with radius 0.75--1~Nm ($sim$9--12~km) and the 1~Nm \textit{Diamond} survey perform best with horizontal RMS misfits of $<$4~m. Although the \textit{PACMAN} and \textit{Diamond} surveys perform nearly equally well in our synthetic test, we prefer the former since its quasi-circular pattern results in a smaller Doppler correction (i.e., the ship remains at a nearly constant radius from the instrument for most of the survey). The \textit{PACMAN} survey recovers the horizontal location to within 10~m even for a survey with radius of 0.5~Nm.

Horizontal instrument location is important for most applications, and its precision increases with survey radius. However, larger surveys require more time at each site and thus are undesirable. The improvement in misfit with increasing survey size saturates at large radius, and this diminishing return can be quantified by a trade-off parameter, $\lambda$, defined as the product between total survey length and horizontal misfit, $\delta r_{xy}$ (Figure~\ref{fig:survey_geom_explore}d). The ideal survey size for recovering horizontal location corresponds to a minimum in this parameter, which occurs at $\sim$0.75~Nm radius for the \textit{PACMAN} survey geometry at 5000~m depth. The saturation of horizontal misfit improvement with increasing radius for \textit{PACMAN} surveys is shown by $\nabla r_{xy}$ in Figure~\ref{fig:survey_geom_explore}e (see also Figure~S6, available in the electronic supplement to this article). The rate of horizontal misfit improvement with increasing radius quickly approaches zero beyond a radius of 0.75--1~Nm.

Depth and water velocity are essentially equally well resolved by most survey geometries with uncertainties of 10--15~m and 2--3~m/s, respectively, depending on survey size. This excludes \textit{Line}, \textit{Circle}, and $<$0.75~Nm \textit{PACMAN} surveys, which exhibit strong $z$-$V_p$ trade-offs. This trade-off can be seen in the resolution and correlation matrices for the \textit{Circle} (Figure~\ref{fig:resolution_correlation}). The \textit{Line} survey poorly estimates depth (RMS $\sim$200~m) but resolves water velocity to within $\sim$5~m/s. The radial portions of the survey patterns are key for successfully resolving the $z$-$V_P$ trade-off, as evidenced by the poor performance by \textit{Circle} surveys. The 1~Nm radius \textit{PACMAN} survey performs best overall, recovering horizontal position, depth, and water velocity to within 3~m, 10~m, and 3~m/s, respectively.


\subsection{Application to PacificArray deployment} \label{sec:PacificArray_deployment}
We applied the location algorithm to acoustic surveys carried out during the Young Pacific ORCA deployment in the central Pacific ocean during April and May of 2018 \citep{Gaherty2018}. The OBS array comprised 30 SIO broadband instruments each equipped with a Model ITC-3013 transponder and deployed from the R/V Kilo Moana in water depths of $\sim$4400-4800 m. Acoustic  surveys were carried out using an EdgeTech 8011M Acoustic Transceiver command and ranging unit, attached to a hull-mounted 12 kHz transducer. The relatively calm seas allowed for ideal survey geometry at almost all sites, with a ship speed of \mbox{$\le$8~knots} at a maximum radius of \mbox{$\sim$1.3~Nm}. 

An example station inversion, as well as the graphical outputs of the location software, is shown in Figures \ref{fig:one_sta_real_survey}-\ref{fig:one_sta_real_ftests}. Ship velocity is estimated from the survey data by differencing neighboring survey points. In theory, this could be used to correct Doppler shifts (Figure \ref{fig:one_sta_real_survey}c) in travel time (as in the synthetic tests), but we found that this correction did not substantially improve data fit for real stations and so did not apply it to this data set, although it is included as an option in the location codes. Furthermore, the ray-bending corrections, $\delta T_{\text{bend}}$, are negligible ($<$0.01~ms) at these water depths (see Figures~S1--S2, available in the electronic supplement to this article) and change the estimated horizontal location, depth, and water velocity by less than 0.2~m, 0.5~m, and 0.3~m/s, respectively; thus, we choose not to apply the ray-bending correction here. The small RMS data misfit of $\sim$1.6~ms attests to the quality of the survey measurements and the appropriateness of our relatively simple location algorithm (Figure \ref{fig:one_sta_real_survey}d). The southwestwards drift of \mbox{$\sim340$~m} (Figure~\ref{fig:one_sta_real_histograms}) demonstrates that ocean currents can substantially displace the final OBS location from their surface drop point. The F-test 95\% confidence bounds are 5--6~m in the horizontal directions and 10--12~m in depth (Figure~\ref{fig:one_sta_real_ftests}).

The 30 stations in this array drifted an average distance of 170 m. The mean data RMS misfit was 1.96 ms and the estimated 95th percentile horizontal location error based on the bootstrap analysis was 1.13 m. The water depth estimated by the inversion was systematically shallower than that measured using the shipboard multibeam instrument, differing by an average value of 18.6 m. Assuming the multibeam depths, which are computed using a water sound speed profile that is validated daily by XBT measurements, are correct, this discrepancy indicates that the inversion systematically overestimates sound speed slightly. 

Without accurate seafloor corroboration from an ROV, it is not possible to directly verify the locations of stations within the Pacific ORCA array. However, we  obtain indirect support for the success of the location algorithm by considering the drift of all stations within this array (Figure \ref{fig:meso_eddy}). Taken together, the direction and magnitude of drift depicts a pattern of clockwise rotation with a minimum diameter of $\sim$500 km. This pattern is consistent with a meso-scale cyclonic gyre, with a direction, location, and approximate size that is consonant with large-scale patterns of geostrophic flow observed in this location roughly within the time frame of the deployment (see Figure~S11, available in the electronic supplement to this article). The fact that we are able to discern this pattern from our estimated locations is a testament to the accuracy of the \textit{OBSrange} algorithm. This observation also raises the intriguing possibility of using OBS instruments as ad hoc depth-integrated flow meters for the oceans. 